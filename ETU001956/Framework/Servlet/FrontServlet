package etu001956.framework.servlet;

import etu001956.test_framework.Emp;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

public class FrontServlet extends HttpServlet {

    protected void service(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
        if (request.getMethod().equals("GET")) {
            // Gérer la requête GET
            // Exemple : Rediriger la requête vers une page JSP pour l'affichage
            request.getRequestDispatcher("/WEB-INF/views/emp.jsp").forward(request, response);
        } else if (request.getMethod().equals("POST")) {
            // Gérer la requête POST
            // Exemple : Traiter les données du formulaire et stocker dans l'objet Emp

            // Récupérer les valeurs saisies dans le formulaire
            String name = request.getParameter("name");
            int age = Integer.parseInt(request.getParameter("age"));
            String dept = request.getParameter("dept");
            double salaire = Double.parseDouble(request.getParameter("salaire"));

            // Créer un objet Emp avec les valeurs saisies
            Emp emp = new Emp();
            emp.setName(name);
            emp.setAge(age);
            emp.setDept(dept);
            emp.setSalaire(salaire);

            // Récupérer la liste d'objets Emp de la session
            List<Emp> empList = (List<Emp>) request.getSession().getAttribute("empList");

            // Vérifier si la liste n'existe pas encore, la créer
            if (empList == null) {
                empList = new ArrayList<>();
            }

            // Ajouter l'objet Emp à la liste
            empList.add(emp);

            // Mettre à jour la liste dans la session
            request.getSession().setAttribute("empList", empList);

            // Rediriger vers la page de succès
            request.getRequestDispatcher("success.jsp").forward(request, response);
        }
    }
}
