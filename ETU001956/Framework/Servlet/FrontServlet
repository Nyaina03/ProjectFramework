import etu001956.framework.Mapping;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.lang.reflect.Method;
import java.util.HashMap;
import etu001956.framework.annotation.Url;
import etu001956.test_framework.*;

public class FrontServlet extends HttpServlet {
    private HashMap<String, Mapping> mappingUrls;

    @Override
    public void init() throws ServletException {
        // Initialisation de l'attribut mappingUrls
        mappingUrls = new HashMap<>();

        // Obtenez la classe Emp
  Class<?> empClass = null;
    try {
        empClass = Class.forName("etu001956.test_framework.Emp");
    } catch (ClassNotFoundException e) {
        // Gérer l'exception ici
        e.printStackTrace();
    }

    if (empClass != null) {
        Method[] methods = empClass.getDeclaredMethods();
        // Le reste de votre code ici
    }




        // Obtenez toutes les méthodes de la classe Emp
        Method[] methods = empClass.getDeclaredMethods();

        // Parcourez les méthodes et recherchez les annotations Url
        for (Method method : methods) {
            if (method.isAnnotationPresent(Url.class)) {
                // Obtenez l'annotation Url
                Url urlAnnotation = method.getAnnotation(Url.class);

                // Obtenez la valeur de l'annotation Url
                String url = urlAnnotation.value();

                // Ajoutez le mapping à la HashMap
                mappingUrls.put(url, new Mapping(empClass.getSimpleName(), method.getName()));
            }
        }

        super.init();
    }

    protected void service(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
        if (request.getMethod().equals("GET")) {
            // Gérer la requête GET
            // Exemple : Rediriger la requête vers une page JSP pour l'affichage
            request.getRequestDispatcher("/WEB-INF/views/index.jsp").forward(request, response);
        } else if (request.getMethod().equals("POST")) {
            // Gérer la requête POST
            // Exemple : Traiter les données du formulaire et effectuer les actions nécessaires
            String username = request.getParameter("username");
            String message = "Bonjour, " + username + "!";

            request.setAttribute("message", message);
            request.getRequestDispatcher("/WEB-INF/views/result.jsp").forward(request, response);
        }
    }
}
